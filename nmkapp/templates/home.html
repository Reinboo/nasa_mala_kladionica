{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

<h1>TRENUTNA KOLA</h1>
<br/>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

<div id="dialog" title="Potvrda" style="display: none;">
Jednom kada klikneš konačan odgovor, više nećeš moći da menjaš tipove! Da li si stvarno siguran?
</div>

<script type="text/javascript">
	$(document).ready(function() {
		var currentForm;
		dialog = $("#dialog").dialog({
			autoOpen: false,
			height: 200,
			width: 350,
			modal: true,
			buttons: {
				'Da': function() {
					currentForm.submit();
				},
				'Ne': function() {
					$(this).dialog('close');
				}
			},
			close: function() {
			}
		});
		
		{% for bet in bets %}
		{% if bet.form %}
		$("form[name='save_{{ bet.round.id }}'] input[type=submit]").click(function() {
			$("input[type=submit]").removeAttr("clicked");
			$(this).attr("clicked", "true");
		});

		$("form[name='save_{{ bet.round.id }}']").submit(function(){
			currentForm = this;
			var val = $("input[type=submit][clicked=true]").val();
			if (val != "Sačuvaj za sada") {
				var hidden_exists = $("input[type=hidden][name='final_save_{{ bet.round.id }}']").length;
				if (hidden_exists == 0) {
					$('<input type="hidden" />').appendTo($(this).first()).attr('name', 'final_save_{{ bet.round.id }}').attr('value', 'final_save_{{ bet.round.id }}');
				}
				$('#dialog').dialog('open');
				return false;
			} else {
				$("input[type=hidden][name='final_save_{{ bet.round.id }}']").remove();
				return true;
			}
		});
		{% endif %}
		{% endfor %}
	});
</script>

{% if messages %}
    {% for message in messages %}
    <div class="entry errors">{{ message }}</div>
    {% endfor %}
{% endif %}

{% for bet in bets %}
	<table class="mediumtable">
    	<tbody>
    		<tr>
        		<td><h2>Kolo: {{ bet.round.name }}</h2></td>
        		<td style="text-align: right;">(preostalo vreme za klađenje: <span style="color: #FF0000;">{{ bet.time_left }}</span>)</td>
    		</tr>
		</tbody>
	</table>
	
	<br/>

	{% if bet.form %}
		{% for error in bet.form.non_field_errors %}
		    <div class="entry errors" style="color: rgb(255, 0, 0);">{{ error }}</div>
		{% endfor %}
		
		<form name="save_{{ bet.round.id }}" method="post" action="/">
			{% csrf_token %}
			<table class="mediumtable">
				<thead>
					<tr>
						<th scope="col">Utakmica</th>
						<th scope="col" style="padding-left: 10px;">1</th>
						<th scope="col" style="padding-left: 10px;">X</th>
						<th scope="col" style="padding-left: 10px;">2</th>
					</tr>
				</thead>
				<tbody>
					{% for field in bet.form %}
					<tr>
						<td><b>{{ field.label_tag }}</b></td>
						{% for radio in field %}
						<td>
							{{ field.errors }}
							{{ radio }}
						</td>
						{% endfor %}
					</tr>
					{% endfor %}
				</tbody>
			</table>
			<p class="offset">
				<input name="save_{{ bet.round.id }}" value="Sačuvaj za sada" type="submit">
				<input name="final_save_{{ bet.round.id }}" value="Konačan odgovor !!!" type="submit">
			</p>
			<ul>
				<li>Sačuvaj za sada &ndash; snimi svoje tipove</li>
				<li>Konačan odgovor &ndash; snimi svoje tipove tako da ne možeš da ih menjaš više, ali možeš da vidiš šta su drugi igrali</li>
			</ul>
		</form>
	
	{% else %}
	
	<table class="mediumtable">
		<thead>
			<tr>
				<th scope="col">Utakmica</th>
				<th scope="col">Tip</th>
				<th scope="col">Kvota</th>
			</tr>
		</thead>
		<tbody>
			{% for shot in bet.shots %}
			<tr>
				<td><b>{{ shot.match.home_team.name }} - {{ shot.match.away_team.name }}</b></td>
				<td>
				{% if shot.shot != None %}
					{% if shot.shot == 0 %}
					X
					{% else %}
					{{ shot.shot }}
					{% endif %}
				{% else %}
				-
				{% endif %}
				</td>
				<td>
				{% if shot.shot != None %}
					{% if shot.shot == 1 %}
					{{ shot.match.odd1 }}
					{% elif shot.shot == 0 %}
					{{ shot.match.oddX }}
					{% else %}
					{{ shot.match.odd2 }}
					{% endif %}
				{% else %}
				-
				{% endif %}
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	
	{% if bet.round %}
	<p class="offset">
		<a href="/roundstandings/{{ bet.round.id }}">Šta su drugi igrali</a>
	</p>
	{% endif %}
	
	{% endif %}
{% endfor %}

{% endblock %}